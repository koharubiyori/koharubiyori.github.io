<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><meta name="baidu-site-verification" content="code-huaq5qAbeF"><title>在TypeScript的全局类型中使用模块导出的类型 - 小春日和の秘密基地</title><meta name="description" content="偶然中在看jQuery的.d.ts文件时发现了答案。"><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@5.8.55/css/materialdesignicons.min.css"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><link rel="stylesheet" href="/libs/normalize.css?timestamp=1709531293722"><link rel="stylesheet" href="/libs/flex.css?timestamp=1709531293722"><link rel="stylesheet" href="/libs/material-components-web.min.css?timestamp=1709531293722"><link rel="stylesheet" href="/libs/mdc.tooltip.min.css?timestamp=1709531293722"><link rel="stylesheet" href="/libs/prism.css?timestamp=1709531293722"><link rel="stylesheet" href="/libs/viewer.min.css?timestamp=1709531293722"><link rel="stylesheet" href="/styles/commons/index.css?timestamp=1709531293722"><link rel="stylesheet" href="/styles/templates/index.css?timestamp=1709531293722"><link rel="stylesheet" href="/styles/partial/index.css?timestamp=1709531293722"><link rel="stylesheet" href="/styles/layout.css?timestamp=1709531293722"><script src="/libs/jquery.min.js?timestamp=1709531293722"></script><script src="/libs/material-components-web.min.js?timestamp=1709531293722"></script><script src="/libs/mdc.tooltip.min.js?timestamp=1709531293722"></script><script src="/libs/prism.min.js?timestamp=1709531293722"></script><script src="/libs/viewer.min.js?timestamp=1709531293722"></script><script src="/scripts/uiRender.js?timestamp=1709531293722"></script><meta name="generator" content="Hexo 5.0.2"></head><body><img class="page-bgImg" src="/sourceImages/bg.png"><header class="mdc-top-app-bar mdc-top-app-bar--fixed mdc-elevation--z4"><div class="mdc-top-app-bar__row"><section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-start"><button id="drawerButton" class="material-icons mdc-top-app-bar__navigation-icon mdc-icon-button">menu</button> <a class="mdc-top-app-bar__title" href="/" style="color:#fff">小春日和の秘密基地</a></section><section class="mdc-top-app-bar__section mdc-top-app-bar__section--align-end"><button id="searchButton" class="material-icons mdc-top-app-bar__action-item mdc-icon-button">search</button></section></div></header><div class="mainContainer flex-row"><div class="page-drawer"><div class="drawer-placeholder"></div><aside class="mdc-drawer drawer-body mdc-elevation--z4"><div class="drawer-header flex-column flex-evenly"><div class="drawer-header--content flex-column flex-cross-center"><img class="drawer-avatar" src="/sourceImages/avatar.png"><div class="drawer-userName">小春日和</div><div class="drawer-totals flex-row flex-cross-center"><div class="flex flex-column flex-center"><div class="drawer-totals--label">文章</div><div class="drawer-totals--value">共14篇</div></div><div class="flex flex-column flex-center"><div class="drawer-totals--label">标签</div><div class="drawer-totals--value">共12个</div></div><div class="flex flex-column flex-center" id="busuanzi_container_site_pv"><div class="drawer-totals--label" style="text-align:center">总访问</div><div class="drawer-totals--value" style="text-align:center"><span id="busuanzi_value_site_pv"></span><span>次</span></div></div></div></div></div><div class="drawer-content"><div class="drawer-list"><a class="drawer-list-item flex-row flex-cross-center materialRipple materialRipple--dark com-pointer" href="/"><i class="list-item--icon material-icons">home</i><span class="list-item--title">首页</span></a><a class="drawer-list-item flex-row flex-cross-center materialRipple materialRipple--dark com-pointer" href="/2020/08/24/日常/再次启程"><i class="list-item--icon material-icons">info</i><span class="list-item--title">关于博客 </span></a><a class="drawer-list-item flex-row flex-cross-center materialRipple materialRipple--dark com-pointer" target="_blank" rel="noopener" href="https://github.com/koharubiyori"><i class="mdi-set mdi-github" style="font-size:24px;color:var(--mdc-theme-primary);line-height:1.1"></i><span class="list-item--title">Github</span></a><a class="drawer-list-item flex-row flex-cross-center materialRipple materialRipple--dark com-pointer" target="_blank" rel="noopener" href="https://zh.moegirl.org.cn/User:%E6%9D%B1%E6%9D%B1%E5%90%9B"><strong style="font-size:18px;color:var(--mdc-theme-primary);margin-left:3px">萌</strong><span class="list-item--title">萌娘百科</span></a></div></div></aside></div><main class="mainContent flex"><div class="page-post"><link rel="stylesheet" href="/styles/post.css?timestamp=1709531293693"><div class="post-header"><h2 class="post-header--title">在TypeScript的全局类型中使用模块导出的类型</h2><div class="post-header--row com-onlyDesktop"><div class="post-header--infoBox" style="background-color:#007fff"><i class="material-icons">watch_later</i><span>2020年08月24日</span></div><div class="post-header--infoBox" style="background-color:#04b431"><i class="material-icons">menu_book</i><span>总字数：1.3k</span></div><div class="post-header--infoBox" style="background-color:#b40486"><i class="material-icons">access_alarm</i><span>预计阅读时间：15分钟</span></div></div><div class="post-header--row post-header--tags" style="justify-content:flex-start;margin-top:10px"><a class="post-header--tag" href="/tags/TypeScript/" title="查看“TypeScript”标签下的文章"><i class="material-icons">local_offer</i><span>TypeScript</span></a></div></div><div class="post-body mdc-elevation--z2"><img class="post-body--headImg" src="https://bn1302files.storage.live.com/y4m7Stf2DFHbz7UTWZ86rSMDle3qF8j3cVRcDlOXahMpXcnJPoapGVfGTA6TDctvrVHd3g2abx-MSqWj_m5M6VgVhx2--q1ezN9u8QBqCTveqR9TIbE7hM7YW72iYJlNQ84TMRTxbUEU_ZuOsOU99WjWZbPqqjCAMeBAh0JS6n5bGWRmth5cGqPl7pCSgIAhh3o?width=1024&amp;height=553&amp;cropmode=none" style="object-position:undefined"><div class="post-body--content"><div class="contentContainer"><p>图片来源：<a target="_blank" rel="noopener" href="https://www.pixiv.net/artworks/79134582">pixiv:チノちゃん。 作者：ふぇありぃあい</a></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在ts中定义一个全局类型很简单，只需要在.d.ts文件中的类型声明前加上<code>declare</code>关键字即可。这对于全局常量或者一些简单类型就已经足够，但如果我们要使用其他模块中的类型，这里就会出现点问题。ts我最喜欢的一点就是刚打出几个字母的光标前就会显示出一排的代码提示，点击后ts又会将对应的模块自动引入，目前为止一切都还很好。但是，如果在声明全局类型的文件中使用<code>import</code>关键字引入了其他模块中的类型，不到一秒就会发现：使用了这些全局类型的文件名全部变红————全局类型声明失效了。</p><p>原因在于，在一个.d.ts文件中引入了其他模块，就会使ts类型系统将其视为一个模块，导致其中的所有类型即使添加了<code>declare</code>关键字也不能直接全局使用，这里就需要一些额外的处理。</p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>先假设的全局变量类型定义文件名为<code>globals.d.ts</code>，目前有这样一个模块，导出了一个名为<code>Person</code>的接口：</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts">&#x2F;&#x2F; myModule.ts
export interface Person &#123;
  name: string
  age: number
&#125;</code></pre><p>假设要使用<code>Person</code>这个类型，这里就需要引入<code>myModule.ts</code>这个文件，问题是在哪里引入，如果在<code>globals.d.ts</code>引入，势必导致其中的全局类型声明全部失效。</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts">&#x2F;&#x2F; globals.d.ts
import &#123; Person &#125; from &#39;myModule&#39;   &#x2F;&#x2F; 引入了一个模块，导致下面的类型定义都无法全局使用

declare type ErrCode &#x3D; 1 | 2 | 3

declare interface School &#123;
  studentList: Person[]
&#125;</code></pre><p>解决办法是：<strong>需要在一个全局命名空间声明文件中引入，并将其放在全局命名空间上。</strong></p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts">&#x2F;&#x2F; myModuleGlobalNamespace.d.ts
import &#123; Person &#125; from &#39;other-module&#39;

export &#x3D; Group         &#x2F;&#x2F; 向外暴露的值只能为一个外部模块(declare module)或外部命名空间(declare namespace)，且只能暴露一个
export as namespace GroupAlias     &#x2F;&#x2F; 向外暴露名为GroupAlias命名空间，暴露的内容为export &#x3D; 的值，这里可以理解为给Group起了一个别名。可以和要暴露的类型名相同

declare namespace Group &#123;
  type Staff &#x3D; Person

  interface Company &#123;
    staffList: Person[]
  &#125;  
&#125;</code></pre><p>上面的声明在全局命名空间上添加了一个<code>GroupAlias</code>命名空间，现在就可以在任意文件中使用<code>GroupAlias.Staff</code>和<code>GroupAlias.Company</code>类型了，唯一变化的就是多了层命名空间。</p><p>不过，这种用法的服务对象本身是给像jQuery这种带有全局命名空间的库使用的(虽然jQuery现在也支持模块化使用了，这里只是举个大家都熟悉的例子)，但也不妨碍使用它来进行全局类型的声明。</p><p>当然，最好还是通过引入模块来使用类型，而不是声明全局类型，变量也是同理，而且ts的自动导入已经做了绝大多数的工作，大部分时候都不再需要手写import。</p><p>另外还有一点需要注意：如果全局命名空间发生了重复，重复的命名空间就会发生覆盖(目前覆盖的策略还没搞清楚)，且没有提示或报错，所以声明全局命名空间时一定注意不要重复。</p><h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>我一般用以下形式使用全局类型声明。</p><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><pre class="line-numbers language-none"><code class="language-none">src
  &gt; @types  &#x2F;&#x2F; 全局类型声明文件夹
    &gt; globalNamespaces  &#x2F;&#x2F;  全局命名空间文件夹
      company.d.ts
      xxx.d.ts
      ...
    globals.d.ts  &#x2F;&#x2F; 全局类型声明主文件，用于声明一些全局变量，简单接口等</code></pre><h3 id="命名格式"><a href="#命名格式" class="headerlink" title="命名格式"></a>命名格式</h3><p>像刚才说的，因为要使用模块化的全局类型就必须多声明一层命名空间，如果只需要一个单独的类型，那么这一层命名空间就会显得多余，且不好理解。所以我一般采用这种做法：所有自定义的全局命名空间都以双下划线开头（这也是为了和jquery这种有全局命名空间的库以及原生js类型做区分），如果是一个命名空间下有多个类型，则正常命名，如果只需要一个单独的类型，则将命名空间命名为类型类型名，将类型命名为双下划线，例如：</p><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts">import &#123; Person &#125; from &#39;other-module&#39;

export &#x3D; Group
export as namespace __Group

&#x2F;&#x2F; 一个命名空间下有两个成员，这个命名空间是有意义的
declare namespace Group &#123;
  type Staff &#x3D; Person

  interface Company &#123;
    staffList: Person[]
  &#125;  
&#125;

&#x2F;&#x2F; 使用：__Group.Staff、__Group.Company</code></pre><pre class="line-numbers language-ts" data-language="ts"><code class="language-ts">import &#123; Person &#125; from &#39;other-module&#39;

export &#x3D; Company
export as namespace __Company

&#x2F;&#x2F; 只有一个成员(且已经明确将来不会增加其他成员)，这层命名空间是没有意义的，直接将接口名作为命名空间名
declare namespace Company &#123;  
  interface __ &#123;
    staffList: Person[]
  &#125;  
&#125;

&#x2F;&#x2F; 使用：__Company.__</code></pre></div><div class="articleLicenses"><p>版权声明：本文为原创文章，版权归 小春日和 所有</p><p style="word-break:break-all"><span>文章链接：</span><a id="articleLink" href="javascript:void()" aria-describedby="tooltip-copyArticleLink">https://koharubiyori.github.io/Typescript/在TypeScript的全局类型中使用模块导出的类型/</a></p><p><span>所有原创文章采用&nbsp;</span><a target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh">署名-非商业性使用 4.0 国际 (CC BY-NC 4.0)</a></p><p>您可以自由转载和修改，但必须保证在显著位置注明文章来源，且不能用于商业目的。</p><div id="tooltip-copyArticleLink" class="mdc-tooltip" role="tooltip" aria-hidden="true"><div class="mdc-tooltip__surface"><lorem>点击复制链接</lorem></div></div></div></div></div><div class="prevNextArticle flex-row flex-between"><a class="nextArticle materialRipple materialRipple--dark mdc-elevation--z2 flex" href="/Vue/Vue框架的Tabs组件封装/" title="Vue框架的Tabs组件封装"><div class="label">上一篇</div><div class="title com-textLimit">Vue框架的Tabs组件封装</div></a><a class="prevArticle materialRipple materialRipple--dark mdc-elevation--z2 flex" href="/小程序/Taro下基于hooks的导航器封装/" title="Taro下基于hooks的导航器封装"><div class="label">下一篇</div><div class="title com-textLimit">Taro下基于hooks的导航器封装</div></a></div><div id="post-comments"></div></div></main><div class="page-sidebar"><div class="sidebar-placeholder"></div><div class="sidebar-body mdc-elevation--z4"><div class="articleContents"><div class="articleContents-title">目录</div></div><div class="katakoto"><div class="katakoto-title">只言片语</div><div class="katakoto-items"><div class="katakoto-item"><div class="katakoto-item--content">第三次重建博客，希望这次不会没写多少东西就又关了...</div><div class="katakoto-item--date">—— 2020年11月21日 09:35</div></div><div class="katakoto-item"><div class="katakoto-item--content">其实我写博客是为了发图的...なんちゃって</div><div class="katakoto-item--date">—— 2020年12月05日 23:35</div></div><div class="katakoto-item"><div class="katakoto-item--content">希望以后每天都能开心...</div><div class="katakoto-item--date">—— 2020年12月07日 10:14</div></div><div class="katakoto-item"><div class="katakoto-item--content">少想多做。</div><div class="katakoto-item--date">—— 2022年07月03日 00:14</div></div></div></div><div class="tags"><div class="tags-title">内容标签</div><a class="tags-item" href="/tags/Electron/" title="查看“Electron”标签下的文章"><i class="material-icons">local_offer</i><span>Electron</span></a><a class="tags-item" href="/tags/Flutter/" title="查看“Flutter”标签下的文章"><i class="material-icons">local_offer</i><span>Flutter</span></a><a class="tags-item" href="/tags/JavaScript/" title="查看“JavaScript”标签下的文章"><i class="material-icons">local_offer</i><span>JavaScript</span></a><a class="tags-item" href="/tags/TypeScript/" title="查看“TypeScript”标签下的文章"><i class="material-icons">local_offer</i><span>TypeScript</span></a><a class="tags-item" href="/tags/前端/" title="查看“前端”标签下的文章"><i class="material-icons">local_offer</i><span>前端</span></a><a class="tags-item" href="/tags/React/" title="查看“React”标签下的文章"><i class="material-icons">local_offer</i><span>React</span></a><a class="tags-item" href="/tags/Vue-js/" title="查看“Vue.js”标签下的文章"><i class="material-icons">local_offer</i><span>Vue.js</span></a><a class="tags-item" href="/tags/前端技术/" title="查看“前端技术”标签下的文章"><i class="material-icons">local_offer</i><span>前端技术</span></a><a class="tags-item" href="/tags/Windows/" title="查看“Windows”标签下的文章"><i class="material-icons">local_offer</i><span>Windows</span></a><a class="tags-item" href="/tags/小程序/" title="查看“小程序”标签下的文章"><i class="material-icons">local_offer</i><span>小程序</span></a><a class="tags-item" href="/tags/Taro/" title="查看“Taro”标签下的文章"><i class="material-icons">local_offer</i><span>Taro</span></a><a class="tags-item" href="/tags/日常/" title="查看“日常”标签下的文章"><i class="material-icons">local_offer</i><span>日常</span></a></div></div></div><div class="page-search"><div class="search-body"><div class="search-input-container flex-row flex-cross-center"><i class="material-icons">search</i><input class="search-input flex" placeholder="搜索文章..."></div><div class="search-result" data-dirty="false" data-emptyresult="false"></div></div></div></div><div class="backTopButton mdc-elevation--z4 flex-row flex-center is-hide materialRipple"><i class="material-icons">north</i></div></body></html>